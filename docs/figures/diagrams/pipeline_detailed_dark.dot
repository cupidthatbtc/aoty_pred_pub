digraph AOTYPipeline {
	compound=true fontname=Arial fontsize=22 label="AOTY Prediction Pipeline: Technical Reference" labeljust=c labelloc=t nodesep=1.0 overlap=false pad=0.5 rankdir=TB ranksep=1.2 splines=polyline
	bgcolor="#1A1A1A"
	node [color="#808080" fillcolor="#2A2A2A" fontcolor="#E8E8E8" fontname=Arial fontsize=14 margin="0.25,0.12" penwidth=1.2 shape=box style="filled,rounded"]
	edge [arrowsize=0.8 color="#B0B0B0" fontcolor="#E8E8E8" fontname=Arial fontsize=8 penwidth=1.2]
	subgraph cluster_input {
		color="#808080" fillcolor="#252525" fontcolor="#E8E8E8" fontname=Arial fontsize=16 label="1. Input" penwidth=2 style="rounded,filled"
		input_file [label="Raw CSV
(130K rows)" fillcolor="#3A3A3A" shape=ellipse]
	}
	subgraph cluster_preprocess {
		color="#808080" fillcolor="#282828" fontcolor="#E8E8E8" fontname=Arial fontsize=16 label="2. Preprocessing" penwidth=2 style="rounded,filled"
		schema_val [label="Schema
Validation"]
		null_handling [label="Null
Handling"]
		date_parsing [label="Date
Parsing"]
		min_ratings [label="Min Ratings
Filter"]
		cleaned_data [label="Cleaned Data
(62K rows)" fillcolor="#2A3A2A" shape=ellipse]
		schema_val -> null_handling
		null_handling -> date_parsing
		date_parsing -> min_ratings
		min_ratings -> cleaned_data
	}
	subgraph cluster_split {
		color="#808080" fillcolor="#232323" fontcolor="#E8E8E8" fontname=Arial fontsize=16 label="3. Data Splitting" penwidth=2 style="rounded,filled"
		within_artist [label="Within-Artist
(temporal)"]
		artist_disjoint [label="Artist-Disjoint
(holdout)"]
		train_set [label="Train (64%)" fillcolor="#2A3A2A" shape=ellipse]
		val_set [label="Val (12%)" fillcolor="#2A3040" shape=ellipse]
		test_set [label="Test (12%)" fillcolor="#352A3A" shape=ellipse]
	}
	subgraph cluster_features {
		color="#808080" fillcolor="#252A25" fontcolor="#E8E8E8" fontname=Arial fontsize=16 label="4. Feature Engineering (fit on train)" penwidth=2 style="rounded,filled"
		temporal_block [label="Temporal
(sequence, gap)"]
		album_type_block [label="Album Type
(one-hot)"]
		artist_history_block [label="Artist History
(LOO stats)"]
		artist_rep_block [label="Artist Rep
(smoothed)"]
		genre_block [label="Genre
(PCA)"]
		collab_block [label="Collaboration
(ordinal)"]
		feature_pipeline [label="Feature Pipeline" fillcolor="#353530"]
	}
	subgraph cluster_model {
		color="#808080" fillcolor="#2A2A22" fontcolor="#E8E8E8" fontname=Arial fontsize=16 label="5. Bayesian Model" penwidth=2 style="rounded,filled"
		prior_config [label="Prior Config
(9 params)"]
		hierarchical [label="Hierarchical
(artist effects)"]
		non_centered [label="Non-centered
Param"]
		time_varying [label="Time-varying
(random walk)"]
		ar1_structure [label="AR(1)
Structure"]
		mcmc_sampling [label="MCMC
(NUTS/GPU)" fillcolor="#253040" penwidth=2]
		posterior [label="Posterior
(4K samples)" fillcolor="#2A3A2A" shape=ellipse]
		prior_config -> hierarchical
		hierarchical -> non_centered
		non_centered -> time_varying
		time_varying -> ar1_structure
		ar1_structure -> mcmc_sampling
		mcmc_sampling -> posterior
	}
	subgraph cluster_eval {
		color="#808080" fillcolor="#28252A" fontcolor="#E8E8E8" fontname=Arial fontsize=16 label="6. Evaluation" penwidth=2 style="rounded,filled"
		convergence [label=Convergence fillcolor="#3A3525" shape=diamond]
		rhat_check [label="R-hat
(<1.01)"]
		ess_check [label="ESS
(>400)"]
		loo_cv [label="LOO-CV
(PSIS)"]
		pareto_k [label="Pareto-k" fillcolor="#3A3525" shape=diamond]
		calibration [label=Calibration]
		sensitivity [label="Sensitivity
Analysis"]
		convergence -> rhat_check
		convergence -> ess_check
		rhat_check -> loo_cv
		ess_check -> loo_cv
		loo_cv -> pareto_k
		pareto_k -> calibration
		calibration -> sensitivity
	}
	subgraph cluster_output {
		color="#808080" fillcolor="#252525" fontcolor="#E8E8E8" fontname=Arial fontsize=16 label="7. Output" penwidth=2 style="rounded,filled"
		predictions [label="Predictions
(95% CI)" fillcolor="#2A3A2A" shape=ellipse]
		model_artifacts [label="Model
Artifacts"]
		publication [label="Publication
Figures"]
	}
	input_file -> schema_val [color="#B0B0B0" penwidth=1.2]
	cleaned_data -> within_artist [color="#B0B0B0" penwidth=1.2]
	cleaned_data -> artist_disjoint [color="#B0B0B0" penwidth=1.2]
	within_artist -> train_set [color="#B0B0B0" penwidth=1.2]
	within_artist -> val_set [color="#B0B0B0" penwidth=1.2]
	within_artist -> test_set [color="#B0B0B0" penwidth=1.2]
	train_set -> temporal_block [color="#4CAF50" penwidth=1.2]
	train_set -> album_type_block [color="#4CAF50" penwidth=1.2]
	train_set -> artist_history_block [color="#4CAF50" penwidth=1.2]
	train_set -> artist_rep_block [color="#4CAF50" penwidth=1.2]
	train_set -> genre_block [color="#4CAF50" penwidth=1.2]
	train_set -> collab_block [color="#4CAF50" penwidth=1.2]
	temporal_block -> feature_pipeline
	album_type_block -> feature_pipeline
	artist_history_block -> feature_pipeline
	artist_rep_block -> feature_pipeline
	genre_block -> feature_pipeline
	collab_block -> feature_pipeline
	feature_pipeline -> prior_config [color="#B0B0B0" penwidth=1.2]
	posterior -> convergence [color="#B0B0B0" penwidth=1.2]
	sensitivity -> predictions [color="#B0B0B0" penwidth=1.2]
	posterior -> model_artifacts [color="#808080" style=dashed]
	sensitivity -> publication [color="#B0B0B0" penwidth=1.2]
	convergence -> mcmc_sampling [color="#808080" constraint=false fontsize=7 style=dashed xlabel=retry]
	sensitivity -> prior_config [color="#808080" constraint=false fontsize=7 style=dashed xlabel=tune]
	test_set -> predictions [color="#808080" style=dashed]
}
